
  create or replace   view DEV_DB.DBT_VAULT.v_stg_location
  
   as (
    














-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH source_data AS (

    SELECT

    LOCATION_CODE,
    LOCATION_ID,
    LOCATION_PLANNING_CODE,
    CANCELLED_FLAG,
    DUMMY_FLAG,
    STORE_GROUP_CODE,
    CURRENCY_ID,
    CONCEPT_CODE,
    SELL_SQUARE_FEET,
    SELL_MQ,
    NOSELL_SQUARE_FEET,
    NOSELL_MQ,
    GROSS_STORE_SIZE,
    SDB_CHANNEL_CODE,
    LOCATION_SUBSUBTYPE_ID,
    LOCATION_SUBSUBTYPE_CODE,
    LOCATION_SUBSUBTYPE_TYPOLOGY,
    LOCATION_SUBTYPE_ID,
    LOCATION_SUBTYPE_CODE,
    LOCATION_SUBTYPE_CODE_TYPOLOGY,
    LOCATION_TYPE_ID,
    LOCATION_TYPE_CODE,
    LOCATION_TYPE_CODE_TYPOLOGY,
    DISTRIBUTION_CHANNEL_ID,
    DISTRIBUTION_CHANNEL_CODE,
    DISTRIBUTION_CHANNEL_TYPOLOGY,
    CITY_ID,
    CITY_CODE,
    STATE_ID,
    STATE_CODE,
    COUNTRY_ID,
    COUNTRY_CODE,
    DISTRICT_ID,
    DISTRICT_CODE,
    ZONE_ID,
    ZONE_CODE,
    REGION_ID,
    REGION_CODE,
    AREA_ID,
    AREA_CODE,
    MACROAREA_ID,
    MACROAREA_CODE,
    LOCATION_STATUS_ID,
    LOCATION_STATUS_CODE,
    REPORTING_UNIT_ID,
    REPORTING_UNIT_CODE,
    MACROZONE_ID,
    MACROZONE_CODE,
    CHANNEL_ID,
    CHANNEL_CODE,
    STORE_GROUP_PLAN_ID,
    STORE_GROUP_PLAN_CODE,
    STORE_GROUP_PLAN_TYPOLOGY,
    CHANNEL_PLAN_ID,
    CHANNEL_PLAN_CODE,
    CHANNEL_PLAN_TYPOLOGY,
    COUNTRY_PLAN_ID,
    COUNTRY_PLAN_CODE,
    LOCATION_OPENING_DATE,
    LOCATION_CLOSURE_DATE,
    CONSOLIDATED_FLAG_ID,
    CONSOLIDATED_FLAG_CODE,
    TIER_CITY_ID,
    TIER_CITY_CODE,
    CHANNEL_PLAN_SORT,
    OPERATION_FLAG,
    INSERT_DATE,
    UPDATE_DATE,
    __DELETE_FLAG,
    __DQ_FLAG,
    __DUMMY_FLAG,
    DATE_PARTITION,
    LDTS,
    SOURCE_FILE

    FROM DEV_DB.DBT_VAULT.raw_location
),

derived_columns AS (

    SELECT

    LOCATION_CODE,
    LOCATION_ID,
    LOCATION_PLANNING_CODE,
    CANCELLED_FLAG,
    DUMMY_FLAG,
    STORE_GROUP_CODE,
    CURRENCY_ID,
    CONCEPT_CODE,
    SELL_SQUARE_FEET,
    SELL_MQ,
    NOSELL_SQUARE_FEET,
    NOSELL_MQ,
    GROSS_STORE_SIZE,
    SDB_CHANNEL_CODE,
    LOCATION_SUBSUBTYPE_ID,
    LOCATION_SUBSUBTYPE_CODE,
    LOCATION_SUBSUBTYPE_TYPOLOGY,
    LOCATION_SUBTYPE_ID,
    LOCATION_SUBTYPE_CODE,
    LOCATION_SUBTYPE_CODE_TYPOLOGY,
    LOCATION_TYPE_ID,
    LOCATION_TYPE_CODE,
    LOCATION_TYPE_CODE_TYPOLOGY,
    DISTRIBUTION_CHANNEL_ID,
    DISTRIBUTION_CHANNEL_CODE,
    DISTRIBUTION_CHANNEL_TYPOLOGY,
    CITY_ID,
    CITY_CODE,
    STATE_ID,
    STATE_CODE,
    COUNTRY_ID,
    COUNTRY_CODE,
    DISTRICT_ID,
    DISTRICT_CODE,
    ZONE_ID,
    ZONE_CODE,
    REGION_ID,
    REGION_CODE,
    AREA_ID,
    AREA_CODE,
    MACROAREA_ID,
    MACROAREA_CODE,
    LOCATION_STATUS_ID,
    LOCATION_STATUS_CODE,
    REPORTING_UNIT_ID,
    REPORTING_UNIT_CODE,
    MACROZONE_ID,
    MACROZONE_CODE,
    CHANNEL_ID,
    CHANNEL_CODE,
    STORE_GROUP_PLAN_ID,
    STORE_GROUP_PLAN_CODE,
    STORE_GROUP_PLAN_TYPOLOGY,
    CHANNEL_PLAN_ID,
    CHANNEL_PLAN_CODE,
    CHANNEL_PLAN_TYPOLOGY,
    COUNTRY_PLAN_ID,
    COUNTRY_PLAN_CODE,
    LOCATION_OPENING_DATE,
    LOCATION_CLOSURE_DATE,
    CONSOLIDATED_FLAG_ID,
    CONSOLIDATED_FLAG_CODE,
    TIER_CITY_ID,
    TIER_CITY_CODE,
    CHANNEL_PLAN_SORT,
    OPERATION_FLAG,
    INSERT_DATE,
    UPDATE_DATE,
    __DELETE_FLAG,
    __DQ_FLAG,
    __DUMMY_FLAG,
    DATE_PARTITION,
    LDTS,
    SOURCE_FILE,
    SOURCE_FILE AS RECORD_SOURCE,
    LOCATION_ID AS LOCATION_KEY,
    LDTS AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    LOCATION_CODE,
    LOCATION_ID,
    LOCATION_PLANNING_CODE,
    CANCELLED_FLAG,
    DUMMY_FLAG,
    STORE_GROUP_CODE,
    CURRENCY_ID,
    CONCEPT_CODE,
    SELL_SQUARE_FEET,
    SELL_MQ,
    NOSELL_SQUARE_FEET,
    NOSELL_MQ,
    GROSS_STORE_SIZE,
    SDB_CHANNEL_CODE,
    LOCATION_SUBSUBTYPE_ID,
    LOCATION_SUBSUBTYPE_CODE,
    LOCATION_SUBSUBTYPE_TYPOLOGY,
    LOCATION_SUBTYPE_ID,
    LOCATION_SUBTYPE_CODE,
    LOCATION_SUBTYPE_CODE_TYPOLOGY,
    LOCATION_TYPE_ID,
    LOCATION_TYPE_CODE,
    LOCATION_TYPE_CODE_TYPOLOGY,
    DISTRIBUTION_CHANNEL_ID,
    DISTRIBUTION_CHANNEL_CODE,
    DISTRIBUTION_CHANNEL_TYPOLOGY,
    CITY_ID,
    CITY_CODE,
    STATE_ID,
    STATE_CODE,
    COUNTRY_ID,
    COUNTRY_CODE,
    DISTRICT_ID,
    DISTRICT_CODE,
    ZONE_ID,
    ZONE_CODE,
    REGION_ID,
    REGION_CODE,
    AREA_ID,
    AREA_CODE,
    MACROAREA_ID,
    MACROAREA_CODE,
    LOCATION_STATUS_ID,
    LOCATION_STATUS_CODE,
    REPORTING_UNIT_ID,
    REPORTING_UNIT_CODE,
    MACROZONE_ID,
    MACROZONE_CODE,
    CHANNEL_ID,
    CHANNEL_CODE,
    STORE_GROUP_PLAN_ID,
    STORE_GROUP_PLAN_CODE,
    STORE_GROUP_PLAN_TYPOLOGY,
    CHANNEL_PLAN_ID,
    CHANNEL_PLAN_CODE,
    CHANNEL_PLAN_TYPOLOGY,
    COUNTRY_PLAN_ID,
    COUNTRY_PLAN_CODE,
    LOCATION_OPENING_DATE,
    LOCATION_CLOSURE_DATE,
    CONSOLIDATED_FLAG_ID,
    CONSOLIDATED_FLAG_CODE,
    TIER_CITY_ID,
    TIER_CITY_CODE,
    CHANNEL_PLAN_SORT,
    OPERATION_FLAG,
    INSERT_DATE,
    UPDATE_DATE,
    __DELETE_FLAG,
    __DQ_FLAG,
    __DUMMY_FLAG,
    DATE_PARTITION,
    LDTS,
    SOURCE_FILE,
    RECORD_SOURCE,
    LOCATION_KEY,
    LOAD_DATE,

    CAST(MD5_BINARY(NULLIF(UPPER(TRIM(CAST(LOCATION_ID AS VARCHAR))), '')) AS BINARY(16)) AS LOCATION_HK,

    CAST(MD5_BINARY(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(__DELETE_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(__DQ_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(__DUMMY_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(AREA_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(AREA_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CANCELLED_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_PLAN_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_PLAN_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_PLAN_SORT AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CHANNEL_PLAN_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONCEPT_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONSOLIDATED_FLAG_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONSOLIDATED_FLAG_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY_PLAN_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY_PLAN_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CURRENCY_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DATE_PARTITION AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISTRIBUTION_CHANNEL_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISTRIBUTION_CHANNEL_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISTRIBUTION_CHANNEL_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISTRICT_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISTRICT_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DUMMY_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(GROSS_STORE_SIZE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(INSERT_DATE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_CLOSURE_DATE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_OPENING_DATE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_PLANNING_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_STATUS_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_STATUS_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBSUBTYPE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBSUBTYPE_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBSUBTYPE_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBTYPE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBTYPE_CODE_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_SUBTYPE_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_TYPE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_TYPE_CODE_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LOCATION_TYPE_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(MACROAREA_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(MACROAREA_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(MACROZONE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(MACROZONE_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(NOSELL_MQ AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(NOSELL_SQUARE_FEET AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(OPERATION_FLAG AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(REPORTING_UNIT_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(REPORTING_UNIT_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SDB_CHANNEL_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SELL_MQ AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SELL_SQUARE_FEET AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STATE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STATE_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STORE_GROUP_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STORE_GROUP_PLAN_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STORE_GROUP_PLAN_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(STORE_GROUP_PLAN_TYPOLOGY AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(TIER_CITY_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(TIER_CITY_ID AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(UPDATE_DATE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ZONE_CODE AS VARCHAR))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ZONE_ID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS LOCATION_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    LOCATION_CODE,
    LOCATION_ID,
    LOCATION_PLANNING_CODE,
    CANCELLED_FLAG,
    DUMMY_FLAG,
    STORE_GROUP_CODE,
    CURRENCY_ID,
    CONCEPT_CODE,
    SELL_SQUARE_FEET,
    SELL_MQ,
    NOSELL_SQUARE_FEET,
    NOSELL_MQ,
    GROSS_STORE_SIZE,
    SDB_CHANNEL_CODE,
    LOCATION_SUBSUBTYPE_ID,
    LOCATION_SUBSUBTYPE_CODE,
    LOCATION_SUBSUBTYPE_TYPOLOGY,
    LOCATION_SUBTYPE_ID,
    LOCATION_SUBTYPE_CODE,
    LOCATION_SUBTYPE_CODE_TYPOLOGY,
    LOCATION_TYPE_ID,
    LOCATION_TYPE_CODE,
    LOCATION_TYPE_CODE_TYPOLOGY,
    DISTRIBUTION_CHANNEL_ID,
    DISTRIBUTION_CHANNEL_CODE,
    DISTRIBUTION_CHANNEL_TYPOLOGY,
    CITY_ID,
    CITY_CODE,
    STATE_ID,
    STATE_CODE,
    COUNTRY_ID,
    COUNTRY_CODE,
    DISTRICT_ID,
    DISTRICT_CODE,
    ZONE_ID,
    ZONE_CODE,
    REGION_ID,
    REGION_CODE,
    AREA_ID,
    AREA_CODE,
    MACROAREA_ID,
    MACROAREA_CODE,
    LOCATION_STATUS_ID,
    LOCATION_STATUS_CODE,
    REPORTING_UNIT_ID,
    REPORTING_UNIT_CODE,
    MACROZONE_ID,
    MACROZONE_CODE,
    CHANNEL_ID,
    CHANNEL_CODE,
    STORE_GROUP_PLAN_ID,
    STORE_GROUP_PLAN_CODE,
    STORE_GROUP_PLAN_TYPOLOGY,
    CHANNEL_PLAN_ID,
    CHANNEL_PLAN_CODE,
    CHANNEL_PLAN_TYPOLOGY,
    COUNTRY_PLAN_ID,
    COUNTRY_PLAN_CODE,
    LOCATION_OPENING_DATE,
    LOCATION_CLOSURE_DATE,
    CONSOLIDATED_FLAG_ID,
    CONSOLIDATED_FLAG_CODE,
    TIER_CITY_ID,
    TIER_CITY_CODE,
    CHANNEL_PLAN_SORT,
    OPERATION_FLAG,
    INSERT_DATE,
    UPDATE_DATE,
    __DELETE_FLAG,
    __DQ_FLAG,
    __DUMMY_FLAG,
    DATE_PARTITION,
    LDTS,
    SOURCE_FILE,
    RECORD_SOURCE,
    LOCATION_KEY,
    LOAD_DATE,
    LOCATION_HK,
    LOCATION_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );

